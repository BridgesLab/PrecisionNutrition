---
title: "HFD and NCD Overlap Probabilities"
author: "Dave Bridges"
date: "September 26, 2024"
format: 
  html:
    toc: true
    toc-location: right
theme: journal
---

## Approach

I wanted to use a Bayesian approach to estimate the probabilities that two QTLs overlap a lot or a litte.  Used [perplexity.ai] to help with this.  This script was last run on `r date()`, and can be found in `r getwd()`.

## Initial Conditions

```{r initial-hypothses}
#defining low and high overlap in terms of the number of transcipts/QTLs that would overlap
low.overlap <- 0.20
high.overlap <- 0.80

#50% prior probablity of high overlap, considering both hypotheses equally likely
prior.low.overlap <- 0.5
prior.high.overlap <- 1-prior.low.overlap
```

## QTLs

The observed data for QTLs

```{r qtl-data}
qtls <- 23
overlapping.qtls <- 3
colocalized.qtls <- 1
```

### Calculating Likelihoods

Calculated this from a binomial distribution.

```{r qtl-probabilities}
high.overlap.likelihood.qtl <- dbinom(colocalized.qtls,
                                      size = qtls,
                                      prob = high.overlap)
low.overlap.likelihood.qtl <- dbinom(colocalized.qtls,
                                     size = qtls,
                                     prob = low.overlap)
```

### Calculating Bayes Factors

$$BF = \frac{P(Data|H_{low-overlap})}{P(Data|H_{high-overlap})}$$
```{r qtl-bayes-factor}
bf.qtl <- low.overlap.likelihood.qtl/high.overlap.likelihood.qtl
```

The Bayes factor for the QTLs favoring the low overlap hypothesis over the high overlap hypothesis is `r bf.qtl`.  This is based on likelihoods of `r low.overlap.likelihood.qtl` for the low overlap hypothesis and `r high.overlap.likelihood.qtl` for the high overlap hypothesis.

### Posterior Probabilities

Calculated using $$P(H_{low-overlap}|Data) = \frac{BF * P(H_{low-overlap})}{BF * P(H_{low-overlap}) + P(H_{high-overlap})}$$

```{r qtl-pp}
qtl.pp <- bf.qtl*prior.low.overlap/(bf.qtl*prior.low.overlap+prior.high.overlap)
```

The posterior probabilty is then `r qtl.pp` favoriting the low overlap hypothesis.

## Transcript - Cholesterol Associations

The observed data for mRNA transcript associations with cholesterol.

```{r genes-data}
genes.ncd <- 1677
overlapping.genes <- 115
```

### Calculating Likelihoods

Calculated this from a binomial distribution.

```{r genes-probabilities}
high.overlap.likelihood.genes <- dbinom(overlapping.genes,
                                      size = genes.ncd,
                                      prob = high.overlap)
low.overlap.likelihood.genes <- dbinom(overlapping.genes,
                                     size = genes.ncd,
                                     prob = low.overlap)
```

### Calculating Bayes Factors

$$BF = \frac{P(Data|H_{low-overlap})}{P(Data|H_{high-overlap})}$$
```{r genes-bayes-factor}
bf.genes <- low.overlap.likelihood.genes/high.overlap.likelihood.genes
```

The Bayes factor for the QTLs favoring the low overlap hypothesis over the high overlap hypothesis is `r bf.genes` (calculated as infinity by R).  This is based on likelihoods of `r low.overlap.likelihood.genes` for the low overlap hypothesis and `r high.overlap.likelihood.genes` for the high overlap hypothesis.

### Posterior Probabilities

Calculated using $$P(H_{low-overlap}|Data) = \frac{BF * P(H_{low-overlap})}{BF * P(H_{low-overlap}) + P(H_{high-overlap})}$$

```{r genes-pp}
genes.pp <- bf.genes*prior.low.overlap/(bf.genes*prior.low.overlap+prior.high.overlap)
```

The posterior probabilty is then `r genes.pp` favoriting the low overlap  hypothesis (This is calculated by R as indistinguishable from 1).


## Session Information

```{r session-info}
sessionInfo()
```

